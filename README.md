# 課題１ 手書き数字（MNIST）分類問題

## データセット

### データセットの作成

データのダウンロード、説明変数の作成などには[Deeplearning4j](https://deeplearning4j.org/)の[MnistDataSetIterator](https://deeplearning4j.org/api/latest/org/deeplearning4j/datasets/iterator/impl/MnistDataSetIterator.html)を利用した。

MnistDataSetIteratorによるデータセット作成処理は次のようなものである。

1. (データセットがダウンロード済みでない場合)[MNISTの公式ページ](http://yann.lecun.com/exdb/mnist/)からトレーニングセット・テストセットの画像データとラベルデータをダウンロード・解凍し、MD5チェックサムによりファイルを検証する。
2. トレーニングセットとテストセットの参照順をそれぞれランダムに並び替える。
3. 参照順に沿って画像データとラベルデータを読み込む。
4. ラベルデータは0から9までの整数なのでそのまま目的変数として利用、画像データは各ピクセルごと0から255までの整数なので[0,1]の範囲で正規化して説明変数に利用する。

MNISTはデータセット配布の時点でトレーニングセットとテストセットが分割済みである。今回、ハイパーパラメータのチューニングは行わなかったからバリデーションセットの利用はなく、したがってデータセットの分割に関して特別な処理は行わなかった。

### データセットへの前処理

データセットの各画像について、それぞれ白黒反転したものを元画像の下に連結する前処理を行った。

画像処理では左右反転やノイズの付加によってデータセットをかさ増しすることがあるが、こと数字に関しては2や3を左右反転すると数字では無くなってしまうし、写真では無いものにノイズを付与しても意味は無いと思ったので、データセットの総数をかさ増しする代わりにそれぞれのデータの説明変数をかさ増してみようと考えたものである。

![前処理](https://user-images.githubusercontent.com/19220989/65810201-68493f00-e1e2-11e9-9080-d85e623d2308.png)

このほか、JavaCVを使って画像の輪郭を抽出する前処理なども試したが、むしろ性能が下がったので採用しなかった。

## モデル構築

![モデル](https://user-images.githubusercontent.com/19220989/65810572-beb87c80-e1e6-11e9-9075-ea8752c0788c.png)

画像処理といえばCNNだろうとの考えから、以前に自然言語処理の分野で試したことのあるCNNをほぼそのまま流用した。

下から畳み込み層、プーリング層、全結合層、出力層を重ねただけの単純なCNNであり、特に工夫した点はない。

パラメータの設定は以下のようにした。

|パラメータ|値|
|----|----|
|バッチサイズ|128|
|エポック数|4|
|L2正則化係数|0.0005|

今回の分類器で最も工夫したのは前処理であり、前処理を行う場合と行わない場合で性能の変化を観察したかった。

この場合、前処理を行った場合に特化したようなチューニングを行ってしまっては不平等な比較になると考えられたから、ハイパーパラメータのチューニングなどは行わなかった。([Adam](https://arxiv.org/abs/1412.6980)による学習率の最適化は行われる。)

## テスト結果

### 前処理を行った場合

![前処理を行った場合の結果](https://user-images.githubusercontent.com/19220989/65811481-d77b5f00-e1f3-11e9-9652-c10e20305a4a.png)

|指標|値|
|----|----|
|recall|0.9806|
|precision|0.9810|
|f-score|0.9807|

### 前処理を行わなかった場合

![前処理を行わなかった場合の結果](https://user-images.githubusercontent.com/19220989/65811471-b7e43680-e1f3-11e9-9d92-c0ab148317e6.png)

|指標|値|
|----|----|
|recall|0.9791|
|precision|0.9800|
|f-score|0.9794|

## コード実行手順

動作環境：Java(>=8), Maven 3

1. このブランチをclone

```
git clone -b mnist https://github.com/ia15076/internship-coding-tasks.git
```

2. コンパイル

```
cd internship-coding-tasks
mvn compile
```

3. 実行

```
mvn exec:java
```
